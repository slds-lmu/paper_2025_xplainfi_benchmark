---
title: "Runtime benchmark results"
format: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup-appendix-01}
#| echo: false
knitr::opts_chunk$set(
	cache = FALSE,
	echo = FALSE,
	fig.height = 9,
	fig.width = 10,
	fig.align = "center"
)
library(ggplot2)
library(data.table)
source(here::here("R", "plotting.R"))
runtime <- readRDS(here::here("results", "runtime", "runtime.rds"))
```

These are the results as boxplots split across FI method with varying $n$ (`n_samples`) and $p$ (`n_features`).

## Runtime (log10 seconds) {.tabset}

Runtime in seconds as measured during experiments on a high performance computing environment are subject to variance due to the shared environment.
Measurement is taken for each method exclusively around the function call doing the feature importance computation.

### PFI

```{r ap-plot-runtime-pfi}
#| fig.cap: "PFI runtime scaling across packages by number of features, faceted by sample size and number of repeats."
#| fig.alt: "Point-range plot comparing PFI runtime in log10 seconds across packages as the number of features increases, faceted by sample size and number of repeats."
plot_runtime_scaling(
	runtime,
	geom = "pointrange",
	x_var = "n_features",
	method = "PFI",
	color = "package",
	facets = c("n_samples", "n_repeats"),
	ncol = 2,
	logscale = TRUE,
	labeller = label_both
)
```


### CFI

```{r ap-plot-runtime-cfi}
#| fig.cap: "CFI runtime scaling across packages by number of features using Gaussian sampler, faceted by sample size and number of repeats."
#| fig.alt: "Point-range plot comparing CFI runtime in log10 seconds across packages as the number of features increases, using a Gaussian conditional sampler, faceted by sample size and number of repeats."
plot_runtime_scaling(
	runtime,
	geom = "pointrange",
	x_var = "n_features",
	method = "CFI",
	color = "package",
	sampler = c("gaussian"),
	facets = c("n_samples", "n_repeats"),
	ncol = 2,
	logscale = TRUE,
	labeller = label_both
)
```

### mSAGE

```{r ap-plot-runtime-msage-1}
#| fig.cap: "mSAGE runtime scaling with sage_n_samples = 100 and n_permutations = 100, faceted by sample size."
#| fig.alt: "Point-range plot comparing mSAGE runtime in log10 seconds across packages with fixed sage_n_samples and n_permutations, faceted by sample size."
plot_runtime_scaling(
	runtime,
	geom = "pointrange",
	x_var = "n_features",
	method = "mSAGE",
	color = "package",
	sage_n_samples = 100,
	n_permutations = 100,
	facets = c("n_samples"),
	ncol = 2,
	logscale = TRUE,
	labeller = label_both
) +
	ggtitle(
		"mSAGE with sage_n_samples = 100, n_permutations = 100"
	)
```

```{r ap-plot-runtime-msage-2}
#| fig.cap: "mSAGE runtime scaling with n = 5000 (excluding sage package), faceted by n_permutations and sage_n_samples."
#| fig.alt: "Point-range plot comparing mSAGE runtime in log10 seconds across packages at n = 5000, faceted by n_permutations and sage_n_samples."
plot_runtime_scaling(
	runtime[package != "sage"],
	geom = "pointrange",
	x_var = "n_features",
	method = "mSAGE",
	color = "package",
	n_samples = 5000,
	facets = c("n_permutations", "sage_n_samples"),
	ncol = 3,
	logscale = TRUE,
	labeller = label_both
) +
	ggtitle(
		"mSAGE with n = 5000"
	)
```

```{r ap-plot-runtime-msage-3}
#| fig.height: 8
#| fig.cap: "mSAGE runtime scaling with n = 5000 and n_permutations = 100, faceted by sage_n_samples."
#| fig.alt: "Point-range plot comparing mSAGE runtime in log10 seconds across all packages at n = 5000 and n_permutations = 100, faceted by sage_n_samples."
plot_runtime_scaling(
	runtime,
	geom = "pointrange",
	x_var = "n_features",
	method = "mSAGE",
	color = "package",
	n_samples = 5000,
	n_permutations = 100,
	facets = "sage_n_samples",
	ncol = 3,
	logscale = TRUE,
	labeller = label_both
) +
	ggtitle(
		"mSAGE with n = 5000 and n_permutations = 1000 (where applicable)"
	)
```


### cSAGE

```{r ap-plot-runtime-csage-1}
#| fig.cap: "cSAGE runtime scaling with sage_n_samples = 100 and n_permutations = 100 using Gaussian sampler, faceted by sample size."
#| fig.alt: "Point-range plot comparing cSAGE runtime in log10 seconds across packages with fixed sage_n_samples and n_permutations using Gaussian sampler, faceted by sample size."
plot_runtime_scaling(
	runtime,
	geom = "pointrange",
	x_var = "n_features",
	method = "cSAGE",
	color = "package",
	sage_n_samples = 100,
	n_permutations = 100,
	facets = c("n_samples"),
	sampler = c("gaussian"),
	ncol = 2,
	logscale = TRUE,
	labeller = label_both
) +
	ggtitle(
		"cSAGE with sage_n_samples = 100, n_permutations = 100"
	)
```

```{r ap-plot-runtime-csage-2}
#| fig.height: 8
#| fig.cap: "cSAGE runtime scaling with n = 5000 using Gaussian sampler, faceted by n_permutations and sage_n_samples."
#| fig.alt: "Point-range plot comparing cSAGE runtime in log10 seconds across packages at n = 5000 using Gaussian sampler, faceted by n_permutations and sage_n_samples."
plot_runtime_scaling(
	runtime,
	geom = "pointrange",
	x_var = "n_features",
	method = "cSAGE",
	color = "package",
	n_samples = 5000,
	facets = c("n_permutations", "sage_n_samples"),
	sampler = c("gaussian"),
	ncol = 3,
	logscale = TRUE,
	labeller = label_both
) +
	ggtitle(
		"cSAGE with n = 5000"
	)
```
